<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
        <title>Pizza Bot</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="./style.css">
    </head>
    <body>
        <div class="center">
            <br>
            <center><h3>Pizza Bot</h3></center>
            <br>
            <img id="productImage" class="dominos" src="dominos.jpg"/>
            <br>
            <form action="/action_page.php">
                <div class="center" id="directions">SELECT A CATEGORY</div>
                <br>
                <div class="">
                    <div class="btn-group">
                        <button type="button" id="btn-category" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Category
                        </button>
                        <div class="dropdown-menu dropdown-category" id="dropdown-list">
                            <a class="dropdown-item" href="#">Pizza</a>
                            <a class="dropdown-item" href="#">Sandwich</a>
                            <a class="dropdown-item" href="#">Pasta</a>
                            <a class="dropdown-item" href="#">Wings</a>
                            <a class="dropdown-item" href="#">Bread</a>
                            <a class="dropdown-item" href="#">GSalad</a>
                            <a class="dropdown-item" href="#">Drinks</a>
                            <a class="dropdown-item" href="#">Dessert</a>
                            <a class="dropdown-item" href="#">Sides</a>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" id="btn-item" class="hidden btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Item
                        </button>
                        <div class="dropdown-menu dropdown-items" id="test-dropdown-list">
                        </div>
                    </div>
                </div>
                <br>
                <h5>Payment Information:</h5>
                <br>
                <input type="text" id="cardnumber" class="inputsq" placeholder="Payment Card Number"/>
                <div class="exp">
                    <input type="text" id="expmonth" class="inputsq exp-month" placeholder="Exp. Month"/>
                    <input type="text" id="expyear" class="inputsq exp-year" placeholder="Exp. Year"/>
                </div>
                <div class="exp">
                    <input type="text" id="securitycode" class="inputsq sec-code" placeholder="Security Code"/>
                    <input type="text" id="billingzip" class="inputsq billing-zip" placeholder="Billing Zip Code"/>
                </div>
            </form> 
            <br>
            <button id="dominos" class="btn btn-primary" type="button">Submit Order</button>
            <br>
            <br>
            <br>
        </div>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
        <script>
            var config = {
                apiKey: "AIzaSyAzngzitaO5nmWemiZoREbtEPyz5399ikw",
                authDomain: "twilioapi-9d541.firebaseapp.com",
                databaseURL: "https://twilioapi-9d541.firebaseio.com",
                projectId: "twilioapi-9d541",
                storageBucket: "twilioapi-9d541.appspot.com",
                messagingSenderId: "586136443689"
            }
            firebase.initializeApp(config)
        </script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script>
            $( document ).ready(function() {
                var database = firebase.database()
                var menuItem
                firebase.database().ref("/menu/").once("value").then(function(snapshot) {
                    var menu = snapshot.val().result
                    var products = snapshot.val().result.Products
                    var categories = snapshot.val().result.Categorization.Food.Categories
                    var pizza = snapshot.val().result.Categorization.Food.Categories[0]
                    var sandwich = snapshot.val().result.Categorization.Food.Categories[1]
                    var pasta = snapshot.val().result.Categorization.Food.Categories[2]
                    var wings = snapshot.val().result.Categorization.Food.Categories[3]
                    var bread = snapshot.val().result.Categorization.Food.Categories[4]
                    var gsalad = snapshot.val().result.Categorization.Food.Categories[5]
                    var chips = snapshot.val().result.Categorization.Food.Categories[6]
                    var drinks = snapshot.val().result.Categorization.Food.Categories[7]
                    var dessert = snapshot.val().result.Categorization.Food.Categories[8]
                    var sides = snapshot.val().result.Categorization.Food.Categories[9]
                    console.log(menu)

                    $("body").on("click", ".dropdown-items a", function(){
                        console.log(this.text)
                        var prodName = this.text
                        $("#directions").text(prodName)
                        for (var key in products) {
                            if(products[key].Name == prodName){
                                var prodCode = products[key].Code
                                var link = "https://cache.dominos.com/olo/5_58_3/assets/build/market/US/_en/images/img/products/larges/" + prodCode + ".jpg"
                                console.log(link)
                                $("#productImage").attr("src", link)
                                menuItem = prodCode
                                console.log(menuItem)
                            }
                        }
                    })

                    $(".dropdown-category a").on("click", function() { 
                        var category = $(this)[0].text
                        $("#btn-item").text(category)
                        $("#directions").text("SELECT AN ITEM")
                        $("#btn-item").removeClass("hidden")

                        var food = snapshot.val().result.Categorization.Food
                        var pizzaList = food.Categories[0].Categories[2].Products
                        var sandwichList = food.Categories[1].Categories[1].Products
                        var pastaList = food.Categories[2].Products
                        var wingsList = food.Categories[3].Products
                        var breadList = food.Categories[4].Products
                        var gsaladList = food.Categories[5].Products
                        var drinksList = food.Categories[7].Products
                        var dessertList = food.Categories[8].Products
                        var sidesList = food.Categories[9].Products

                        function getFoodData(foodList){
                            var foodDataArray = []
                            for (let i = 0; i < foodList.length; i++){
                                var prodInfo = products[foodList[i]]
                                foodDataArray.push(prodInfo)
                            }
                            return foodDataArray
                        }

                        function getFoodNames(foodArray){
                            var foodNames = []
                            for (let i = 0; i < foodArray.length; i++){
                                foodNames.push(foodArray[i].Name)
                            }
                            return foodNames
                        }

                        function populateItems(foodNamesList){
                            var thisUL = document.getElementById("text-dropdown-list")
                            var drop = document.getElementById("test-dropdown-list")
                            while (drop.hasChildNodes()) {
                                drop.removeChild(drop.firstChild);
                            }
                            for(var i = 0; i < foodNamesList.length; i++) {
                                var link = document.createElement("a")
                                link.text = foodNamesList[i]
                                link.setAttribute("class", "dropdown-item")
                                $(".dropdown-item").addClass("menu-item");
                                link.setAttribute("href", "#")
                                drop.appendChild(link)
                            }
                        }

                        switch(category) {
                            case "Pizza":
                                var pizzaArray = getFoodData(pizzaList)
                                var pizzaNamesList = getFoodNames(pizzaArray)
                                populateItems(pizzaNamesList)
                                break;
                            case "Sandwich":
                                var sandwichArray = getFoodData(sandwichList)
                                var sandwichNamesList = getFoodNames(sandwichArray)
                                populateItems(sandwichNamesList)
                                break;
                            case "Pasta":
                                var pastaArray = getFoodData(pastaList)
                                var pastaNamesList = getFoodNames(pastaArray)
                                populateItems(pastaNamesList)
                                break;
                            case "Wings":
                                var wingsArray = getFoodData(wingsList)
                                var wingsNamesList = getFoodNames(wingsArray)
                                populateItems(wingsNamesList)
                                break;
                            case "Bread":
                                var breadArray = getFoodData(breadList)
                                var breadNamesList = getFoodNames(breadArray)
                                populateItems(breadNamesList)
                                break;
                            case "GSalad":
                                var gsaladArray = getFoodData(gsaladList)
                                var gsaladNamesList = getFoodNames(gsaladArray)
                                populateItems(gsaladNamesList)
                                break;
                            case "GSalad":
                                var gsaladArray = getFoodData(gsaladList)
                                var gsaladNamesList = getFoodNames(gsaladArray)
                                populateItems(gsaladNamesList)
                                break;
                            case "Drinks":
                                var drinksArray = getFoodData(drinksList)
                                var drinksNamesList = getFoodNames(drinksArray)
                                populateItems(drinksNamesList)
                                break;
                            case "Dessert":
                                var dessertArray = getFoodData(dessertList)
                                var dessertNamesList = getFoodNames(dessertArray)
                                populateItems(dessertNamesList)
                                break;
                            case "Sides":
                                var sidesArray = getFoodData(sidesList)
                                var sidesNamesList = getFoodNames(sidesArray)
                                populateItems(sidesNamesList)
                                break;
                            default:
                                break;
                        }
                    })

                    $("#dominos").on("click", function() {
                        $(this).toggleClass("x-depth-5")         
                        console.log("Requesting Dominos...")
                        //var proxy = "http://cors-anywhere.herokuapp.com/"
                        var development = "http://localhost:1337"
                        var sms = "http://localhost:1337/sms"
                        var production = "https://twilioapi-io.herokuapp.com/"

                        fetch(production)
                            .then(function(response) {
                                console.log(response)
                                return response.json()
                            })
                            .then(function(myJson) {
                                console.log(myJson)
                            })

                        var cardnumber = document.getElementById("cardnumber").value
                        var expmonth = document.getElementById("expmonth").value
                        var expyear = document.getElementById("expyear").value
                        var securitycode = document.getElementById("securitycode").value
                        var billingzip = document.getElementById("billingzip").value
                        console.log("Card Number: " + cardnumber)
                        console.log("Exp. Month: " + expmonth)
                        console.log("Exp. Year: " + expyear)
                        console.log("Security Code: " + securitycode)
                        console.log("Billing Zip Code: " + billingzip)
                        console.log("Menu Item: " + menuItem)

                        $.post( production, {
                            cardnumber: cardnumber,
                            expmonth: expmonth,
                            expyear: expyear,
                            securitycode: securitycode,
                            billingzip: billingzip,
                            menuitem: menuItem
                        },
                            function(data, status){
                                console.log(data)
                                console.log(status)
                            })
                    })

                    $("#dominos").on("mousedown", function(){
                        $(this).toggleClass("x-depth-5")         
                    })
                })
            })
        </script>
    </body>
</html>
